# 天鳳データ統合機能

## 概要

このドキュメントでは、Basecampアプリケーションに実装された天鳳（オンライン麻雀）のデータ統合機能について説明します。

## 実装内容

### 1. APIエンドポイント

#### GET /api/tenhou
- 天鳳の統計データを取得
- 保存されたデータがある場合は、24時間以内のデータを返す
- それ以外の場合はデフォルトデータを返す

#### POST /api/tenhou/update
- 手動でデータを更新するエンドポイント
- JSONファイルにデータを保存

### 2. コンポーネント

#### TenhouWidget
- 天鳳の統計情報を表示するウィジェット
- 段位、レーティング、対戦数を表示
- 詳細表示モードで順位分布や各種率を表示

#### TenhouUpdateForm
- 手動でデータを更新するためのフォーム
- モーダルダイアログ形式で表示

### 3. データ構造

```typescript
interface TenhouStats {
    username: string;
    rank: string;          // 段位（例: "四段"）
    rating: number;        // レーティング（例: 1610）
    games: number;         // 対戦数
    placements: {          // 順位分布（%）
        first: number;
        second: number;
        third: number;
        fourth: number;
    };
    winRate: number;       // 和了率（%）
    dealInRate: number;    // 放銃率（%）
    riichiRate: number;    // 立直率（%）
    callRate: number;      // 副露率（%）
    totalPoints?: number;  // 通算得点
    averagePoints?: number;// 平均得点
    averageRank?: number;  // 平均順位
    lastUpdated: string;   // 最終更新日時
}
```

## 使用方法

1. **自動表示**: ホームページのウィジェットエリアに天鳳の統計が自動的に表示されます

2. **手動更新**:
   - ウィジェットの「詳細を見る」をクリック
   - 「手動でデータを更新」リンクをクリック
   - フォームに最新のデータを入力して「更新」ボタンをクリック

## 制限事項

1. **nodocchi.moeの制限**: 
   - サイトがJavaScriptで動的にレンダリングされるため、直接的なスクレイピングができません
   - 現在は手動更新のみサポート

2. **データの永続性**:
   - データはJSONファイルに保存されます
   - サーバーの再起動でもデータは保持されます
   - ただし、デプロイ環境によってはファイルシステムが永続的でない場合があります

## 将来の改善案

1. **自動データ取得**:
   - Puppeteer/Playwrightを使用したヘッドレスブラウザでの自動取得
   - 天鳳の公式APIが利用可能になった場合の対応

2. **データベース対応**:
   - PostgreSQLなどのデータベースへの移行
   - 履歴データの保存と推移グラフの表示

3. **画像認識**:
   - スクリーンショットからのOCRによるデータ抽出

4. **通知機能**:
   - 段位が上がった時の通知
   - 特定の成績達成時の通知